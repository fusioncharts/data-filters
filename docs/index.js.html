<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>index.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="FCDataFilterExt.html">FCDataFilterExt</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">index.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>'use strict';

const FilterVisual = require('./filtervisual');

/**
 * Class representing the Data Aggregator.
 */
class FCDataFilterExt {
  /**
   * Create a Data Filter.
   * @param {Object} datastore - Consists of Global Data Store
   * @param {Object} userconfig - Consists of user's configauration
   * @param {Boolean} userconfig.hideControl - If 'true', control panel is rendered else not.
   * @param {Boolean} userconfig.dynamicControl - If 'true', filter applies on any change in filter
      else an apply button is provided to filter.
   * @param {Array} userconfig.blockedCategories - Consists of categories which will not be shown in
      filter control panel.
   * @param {Array} userconfig.disabledCategories - Consists of categories which will remain inactive in
      filter control panel.
   * @param {Object} userconfig.disabledItems - Consists of categories whose sub-categories
      which will remain inactive in filter control panel.
   * @param {Array} userconfig.disabledItems.sampleCategory - Consists of sub-categories
      which will remain inactive in filter control panel.
   * @param {Object} userconfig.range - Consists of measure values.
   * @param {Object} userconfig.range.sampleMeasure - Consists of measure values and configurations.

   * @param {Object} userconfig.range.sampleMeasure.min - Consists of min value of a measure.
   * @param {Object} userconfig.range.sampleMeasure.max - Consists of max value of a measure.
   * @param {Object} userconfig.range.sampleMeasure.step - Consists of step value of slider.
   * @param {Object} userconfig.range.sampleMeasure.precision - Consists of precision value (number of decimal points).

   * @param {string} id - Id of the container of Control panel
   * @param {function} cb - Callback function to apply filter
   */
  constructor (datastore, userconfig, id, cb) {
    /**
    * @private
    * User configuration format
    * {
    *   hideControl: false,
    *   dynamicControl: false,
    *   blockedCategories: ['Product'],
    *   disabledCategories: ['Product'],
    *   disabledItems: {
    *     'Product' : ['Tea']
    *   },
    *   range: {
    *     year: {min: 2000, max: 2010, step: 3, precision: 2}
    *   }
    * }
    */
    this.multiChart = new MultiCharting();
    this.datastore = datastore;
    this.callback = cb;
    this.userconfig = userconfig || {};
    this.displayConfig = this.createMenuConfigFromData();
    this.filterVisual = new FilterVisual(this.displayConfig, id, this);
    // data set
  }

  generateBlockList (_list) {
    var list = _list || [],
      i = 0,
      ii = list.length,
      key,
      includeAll = false,
      blockList = [],
      item = {},
      itemListArr = [],
      j = 0,
      jj = 0,
      min = 0,
      max = 0,
      subItem = {};
    for (i = 0; i &lt; ii; ++i) {
      item = list[i];
      includeAll = false;
      // if config was disabled or not visible; skip
      if (item.disabled || !item.visible) {
        continue;
      }
      // Operation for type string
      if (item.type === 'string') {
        for (j = 0, jj = item.items.length; j &lt; jj; ++j) {
          subItem = item.items[j];
          if (!subItem.disabled &amp;&amp; (includeAll || !subItem.checked)) {
            if (blockList.indexOf(item.category + subItem.value) === -1) {
              blockList.push(item.category + subItem.value);
            } // end if
          } // end if
        } // end for j
      } // end if
      // operation for type number
      if (item.type === 'number') {
        for (j = 0, jj = item.items.length; j &lt; jj; ++j) {
          subItem = item.items[j];
          min = item.range.min;
          max = item.range.max;
          if (includeAll || subItem.value &lt; min || subItem.value > max) {
            if (blockList.indexOf(item.category + subItem.value) === -1) {
              blockList.push(item.category + subItem.value);
            } // end if
          } // end if
        } // end for j
      } // end if
    } // end for i
    return blockList;
  } // end function

  /**
  * @private
  * function that will be called after
  * apply has been clicked in ui
  */
  apply (config) {
    var dataprocessor = this.multiChart.createDataProcessor(),
      datastore = this.multiChart.createDataStore();
    dataprocessor.filter(this.createFilter(config));
    // Executing the callback function whenever filter is applied
    this.callback(this.datastore.getData(dataprocessor));
  }

  createFilter (_config) {
    var config = _config || this.displayConfig,
      blockList = this.generateBlockList(config);
    return function (object, index, array) {
      var key;
      for (key in object) {
        if (blockList.indexOf(key + object[key]) !== -1) {
          return;
        }
      }
      return object;
    };
  }

  /**
  * @private
  * Create config menu according to which
  * view will be rendered.
  */
  createMenuConfigFromData () {
    var userconfig = this.userconfig,
      configOb = {
        visible: !userconfig.hideControl,
        dynamic: userconfig.dynamicControl === undefined ? true : userconfig.dynamicControl,
        data: []
      },
      config = configOb.data,
      datastore = this.datastore,
      key = '',
      temp = {},
      tempArr = {},
      type = '',
      keysArr = datastore.getKeys(),
      i = 0,
      ii = 0;
    if (!datastore) {
      return;
    }
    // Iterating over unique keys
    for (i = 0, ii = keysArr.length; i &lt; ii; ++i) {
      key = keysArr[i];
      temp = {
        category: key,
        visible: true
      };
      this.__createItemsList__(temp);
      this.__applyUserConfig__(temp);
      config.push(temp);
    }
    return configOb;
  }

  __createItemsList__ (object) {
    var datastore = this.datastore,
      category = object.category,
      valuesArr = datastore.getUniqueValues(category),
      type = this.__getType__(valuesArr, category),
      min = 0,
      max = 0,
      i = 0,
      ii = 0,
      step = 0,
      precision = 0;
    // setting type
    object.type = type;
    if (type === 'string') {
      // string will have items list
      object.items = [];
      for (i = 0, ii = valuesArr.length; i &lt; ii; ++i) {
        object.items.push({
          value: valuesArr[i],
          disabled: false,
          checked: true
        });
      }
    } else if (type === 'number') {
      // numbers will have range and a value list
      object.items = [];
      for (i = 0, ii = valuesArr.length; i &lt; ii; ++i) {
        object.items.push({
          value: valuesArr[i]
        });
      }
      min = Math.min.apply(null, valuesArr);
      max = Math.max.apply(null, valuesArr);
      if (this.userconfig.range &amp;&amp; this.userconfig.range[category]) {
        if (this.userconfig.range[category].min &amp;&amp; this.userconfig.range[category].min > min) {
          min = this.userconfig.range[category].min;
        }
        if (this.userconfig.range[category].max &amp;&amp; this.userconfig.range[category].max &lt; max) {
          max = this.userconfig.range[category].max;
        }
        step = this.userconfig[category].step || 0;
        precision = this.userconfig[category].precision || 2;
      }
      object.range = {
        min: min,
        max: max,
        step: step,
        precision: precision
      };
    }
  }

  __applyUserConfig__ (object) {
    var userconfig = this.userconfig,
      type = object.type,
      category = object.category,
      blockedCategories = userconfig.blockedCategories,
      disabledCategories = userconfig.disabledCategories,
      disabledItems = userconfig.disabledItems &amp;&amp; userconfig.disabledItems[category],
      items = object.items || [],
      i = 0,
      ii = items.length;

    if (Array.isArray(blockedCategories) &amp;&amp; blockedCategories.indexOf(category) !== -1) {
      object.visible = false;
    }
    if (Array.isArray(disabledCategories) &amp;&amp; disabledCategories.indexOf(category) !== -1) {
      object.disabled = true;
    }

    if (Array.isArray(disabledItems)) {
      for (; i &lt; ii; ++i) {
        if (disabledItems.indexOf(items[i].value) !== -1) {
          object.items[i].disabled = true;
        }
      }
    }
  }

  __getType__ (arr, category) {
    let i = arr.length,
      userconfig = this.userconfig,
      type = {
        string: 'string',
        number: 'number'
      };
    while (i--) {
      if (isNaN(+arr[i])) {
        return type.string;
      }
    }
    if (!userconfig.range || !userconfig.range[category]) {
      // return type.string;
    }
    return type.number;
  }
}
window.FCDataFilterExt = FCDataFilterExt;
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.3</a> on Thu Nov 17 2016 15:41:17 GMT+0530 (IST) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
